import pymongo 

from petrel import storm
from petrel.emitter import BasicBolt 

class WordCountBolt(BasicBolt):
    def __init__(self):
        super(WordCountBolt, self).__init__(script=__file__)
        self.stop_words = set(nltk.corpus.stopwords.words('english'))
        self.stop_words.update(['http', 'https', 'rt'])
    
    def initialize(self,conf,context):
        self.db= pymongo.MongoClient()
        self.client = self.db.BAD
        
    def declareOutputFields(self):
        return[]

    def process(self,tup):
        #if tup.is_tick_tuple():
            #self.emitCurrentWindowCounts()
        #else:
        self.client.word.update(
            {'word':tup.values[0]},
            {"$inc": { count: 1}},
            upsert=True
        )


    def getComponentConfiguration(self):
        return {"topology.tick.tuple.freq.secs":300}

def run():
    WordCountBolt().run()
